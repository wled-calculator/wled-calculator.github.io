<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="copyright" content="&copy; 2022 Wladislaw Waag" />
  <title>LED power calculator</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx" crossorigin="anonymous">
  <style>
	a { color: #0000EE; cursor: pointer; text-decoration: underline;}
  </style>
</head>
<body>
<div class="container m-2 p-0">
  <h3 style="font-weight: bold;">LED power calculator</h3>
  
  <div class="form-floating mb-1">
  <select id="lang" onchange="LangChanged();" class="form-select" aria-label="" style="min-width: 200px; width:auto;">
        <option value="0">Deutsch</option>
        <option value="1">English</option>
  </select>
  <label for="lang">Language/Sprache:</label>
  </div>
  
  <div class="accordion accordion-flush">
    <div class="accordion-item">
		<h2 class="accordion-header" id="headingOne">
		  <button class="accordion-button collapsed" style="padding-left:0;" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
			<span id="L01"><span style="color:red">Attention:</span> estimation only. <span style="color:blue;text-decoration: underline;">Find out here more details</span></span>
		  </button>
		</h2>
		<div id="collapseOne" class="accordion-collapse collapse" aria-labelledby="headingOne" data-bs-parent="#accordionExample">
		  <div class="accordion-body">
			<ul>
				<li id="L02b" style='color:red'></li>
				<li id="L02c"></li>
				<li id="L02d"></li>
				<li id="L02e"></li>
				<li id="L02f"></li>
				<li id="L02g"></li>
			</ul> 
		  </div>
		</div>
	</div>
  </div>
      <hr>
      <div id="MainContainer">
          <h5 id="L03" style="font-weight: bold;">Input fields:</h5>
		    <div class="container m-0 p-0">
			 <div class="row row-cols-auto">
			  
			  <div class="col mb-1">
				  <div class="form-floating">
					<select id="select-leds" onchange="CalcResults();" class="form-select" aria-label="" style="min-width: 320px; width:auto;"></select>
					<label for="select-leds"><span id="L04">LED strip type:</span></label>
				  </div>
			  </div>
			  
			  <div class="col mb-1">
				  <div class="form-floating">
					<select id="select-colors" onchange="CalcResults();"  class="form-select" aria-label="" style="min-width: 320px; width:auto;">
					</select>
					<label for="select-leds"><span id="L05">Color:</span></label>
				  </div>
			  </div>
			  
			  <div class="col mb-1">
				  <div  class="form-floating">
					<input id="input-numberofleds" type="number" min="1" size="5" data-bind="value:input-numberofleds" onchange="CalcResults();" class="form-control" aria-label="" style="min-width: 320px; width:auto;">
					<label for="input-numberofleds"><span id="L06">Number of LEDs:</span></label>
				  </div>
			  </div>
			  
			  <div class="col mb-1">
				  <div class="form-floating">
					<select id="select-brightness" onchange="CalcResults();" class="form-select" aria-label="" style="min-width: 320px; width:auto;"></select>
					<label for="select-brightness"><span id="L07">Brightness:</span></label>
				  </div>
              </div>
			  
			  <div class="col mb-1">
				  <div class="form-floating">
					<input id="input-wirelen" type="number" min="1" size="5" onchange="CalcResults();" class="form-control" aria-label="" style="min-width: 320px; width:auto;">
					<label for="input-wirelen"><span id="L08">Wire length [cm]:</span></label>
				  </div>
			  </div>
			  
			  <div class="col mb-1">
				  <div class="form-floating">
				  <select id="select-temp" onchange="CalcResults();" class="form-select" aria-label="" style="min-width: 320px; width:auto;"></select>
					<label for="select-temp"><span id="L09">Ambient temperature:</span></label>
				  </div>
			  </div>
			  
			  <div class="col mb-1">
				  <div class="form-floating">
					<select id="select-vdrop" onchange="CalcResults();" class="form-select" aria-label="" style="min-width: 320px; width:auto;"></select>
					<label for="select-vdrop"><span id="L10">Max voltage drop:</span></label>
				  </div>
			  </div>
			  
			  <div class="col mb-1">
				  <div class="form-floating">
				  <select id="select-systems" onchange="CalcResults();" class="form-select" aria-label="" style="min-width: 320px; width:auto;">
				  </select>
					<label for="select-systems"><span id="L11">Wire laying:</span></label>
				  </div>
			  </div>
			  
			  <div class="col mb-1">
				  <div class="form-floating">
				  <select id="select-wire-cs" onchange="CalcResults();" class="form-select" aria-label="" style="min-width: 320px; width:auto;">
					<option value="wires">EU type (in mm2)</option>
					<option value="wires_us">US type (AWG)</option>
				  </select>
					<label for="select-wire-cs"><span id="L20">Wire cross sections to use:</span></label>
				  </div>
			  </div>
			  
			 </div>
			</div>
          <img src="System.jpg" class="img-fluid" alt="system schematics" style="width:400px;">
          <hr>
          <div>
            <h5 id="L12" style="font-weight: bold;">Results:</h5>		  
          <ul>
            <li>
				<span id="L12a">LED power consumption: </span>
				<span><b style="white-space: nowrap;"><span id="power_result"></span> W</b> / <b style="white-space: nowrap;"><span id="current_result"></span> A</b></span>
			</li>
			
            <li>
				<span id="L12b">Recommended minimal wire crosssection: </span>
				<span><b style="white-space: nowrap;"><span id="mm2_result"></span> mm<sup>2</sup></b> (<b style="white-space: nowrap;">AWG <span id="awg_result"></span></b>)</span>
			</li>
			
            <li>
				<span id="L12c">Recommended fuse (automotive standart or mini): </span>
				<span><b style="white-space: nowrap;"><span id="fuse_result"></span> A</b> <span id="fuse_result_color"></span></span>
			</li>
			
            <li>
				<span id="L12d">Total voltage drop (wire  + fuse): </span>
				<span><b style="white-space: nowrap;"><span id="vdrop_result"></span> V</b></span>
			</li>
			
			<li>
				<span id="L21">Recommended number of power injections: </span>
				<span><b style="white-space: nowrap;"><span id="numinj_result"></span></b><span id="injstring_result"></span</span>
			</li>
          </ul>
		  
		  
		  <div class="accordion" id="InjAccordion">
			<div class="accordion-item">
				<h2 class="accordion-header" id="headingInjDetails">
				  <button class="accordion-button collapsed" style="padding-left:0;" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne1" aria-expanded="true" aria-controls="collapseOne">
					<span id="L22" style="color:blue;text-decoration: underline;">Strom Einspeisungen planen:</span>
				  </button>
				</h2>
				<div id="collapseOne1" class="accordion-collapse collapse" aria-labelledby="headingInjDetails" data-bs-parent="#accordionInjDetails">
				  <div class="accordion-body">
					<div id="SystemImageInj">
						<img src="System_2inj.jpg" class="img-fluid" alt="system schematics" style="width:400px;">
					</div>
					<div class="container m-0 p-0">
						<div class="row row-cols-auto">
							<div class="col mb-1" id="wlen1">
							  <div class="form-floating">
								<input id="input-wirelen1" type="number" min="1" size="5" onchange="CalcResults();" class="form-control" aria-label="" style="min-width: 320px; width:auto;">
								<label for="input-wirelen1"><span id="L23_1">Wire length injection L1 [cm]:</span></label>
							  </div>
							</div>
							<div class="col mb-1" id="wlen2">
							  <div class="form-floating">
								<input id="input-wirelen2" type="number" min="1" size="5" onchange="CalcResults();" class="form-control" aria-label="" style="min-width: 320px; width:auto;">
								<label for="input-wirelen2"><span id="L23_2">Wire length injection L2 [cm]:</span></label>
							  </div>
							</div>
							<div class="col mb-1" id="wlen3">
							  <div class="form-floating">
								<input id="input-wirelen3" type="number" min="1" size="5" onchange="CalcResults();" class="form-control" aria-label="" style="min-width: 320px; width:auto;">
								<label for="input-wirelen3"><span id="L23_3">Wire length injection L3 [cm]:</span></label>
							  </div>
							</div>
							<div class="col mb-1" id="wlen4">
							  <div class="form-floating">
								<input id="input-wirelen4" type="number" min="1" size="5" onchange="CalcResults();" class="form-control" aria-label="" style="min-width: 320px; width:auto;">
								<label for="input-wirelen4"><span id="L23_4">Wire length injection L4 [cm]:</span></label>
							  </div>
							</div>
							
							
						</div>	
					</div>					
					
					<div>
						<h6 id="L24" style="font-weight: bold;">Injections results:</h6>
						<div class="table-responsive">
						<table id="InjResults" class="table table-bordered">
						 <thead id="InjResultsHead">

						 </thead>
						 <tbody id="InjResultsBody">
							
						 <tbody>
						</table>
						</div>
						<span id="AttentionToLongWire" style="color:red"></span>
					</div>
				  </div>
				</div>
			</div>
		  </div>
		  
		  
          </div>
      </div>
      <div id="WaitContainer">
        <span id="L13">Please wait ... loading dataset ...</span>
      </div>
      <hr>
      <div>
      <h5 id="L14" style="font-weight: bold;">Nützliche Informationen:</h5>
        <ul>
          <li><span id="L14a">WLED Wiki:</span> <a href="https://kno.wled.ge">https://kno.wled.ge</a></li>
          <li><span id="L14b">DIY WLED boards:</span> <a href="https://github.com/wladwnt/wled">Github</a></li>
          <li><span id="L14c">Professionelle WLED Boards:<a href="https://wled.shop">WLED Shop</a></span></li>
          <li><span id="L14d">WEB-based WLED software installer:</span> <a href="https://wled-install.github.io">WLED-INSTALL</a></li>
        </ul>
      </div>
     <hr><hr>
	<div class="accordion accordion-flush" id="accordionBottom">
		<div class="accordion-item">
			<h2 class="accordion-header" id="headingImprint">
			  <button class="accordion-button collapsed" style="padding-left:0;" type="button" data-bs-toggle="collapse" data-bs-target="#collapseImprint" aria-expanded="true" aria-controls="collapseOne">
				<span id="L18" style="color:blue;text-decoration: underline;">Impressum</span>
			  </button>
			</h2>
			<div id="collapseImprint" class="accordion-collapse collapse" aria-labelledby="headingImprint" data-bs-parent="#accordionBottom">
			  <div class="accordion-body">
				<div id="imprint"></div>
			  </div>
			</div>
		</div>
		
		<div class="accordion-item">
			<h2 class="accordion-header" id="headingPrivacy">
			  <button class="accordion-button collapsed" style="padding-left:0;" type="button" data-bs-toggle="collapse" data-bs-target="#collapsePrivacy" aria-expanded="true" aria-controls="collapseOne">
				<span id="L19" style="color:blue;text-decoration: underline;">Datenschutzerklärung</span>
			  </button>
			</h2>
			<div id="collapsePrivacy" class="accordion-collapse collapse" aria-labelledby="headingPrivacy" data-bs-parent="#accordionBottom">
			  <div class="accordion-body">
				<div id="dataprivacy"></div>
			  </div>
			</div>
		</div>
	  </div>
</div>
<script>
var dataset;
var MAX_INJ=4;
function LangChanged() {
    if(document.getElementById('lang').selectedIndex==0) {
        if(document.getElementById('L01')) document.getElementById('L01').innerHTML = "<span style='color:red'>Achtung:</span> nur eine Schätzung! <span style='color:blue;text-decoration: underline;'>Erfahren Sie hier mehr Details</span>";
        if(document.getElementById('L02b')) document.getElementById('L02b').innerHTML = "Für eine detaillierte Auslegung einer elektrischen Anlage müssen Sie genau die in Ihrem Land geltenden normativen Vorgaben erfüllen! Dieser Rechner kann lediglich eine erste Schätzung liefern!";
        if(document.getElementById('L02c')) document.getElementById('L02c').innerHTML = "Normative Grundlagen: VDE 0298 Teil 2 und 4, VDE 0100 Teil 430";
        if(document.getElementById('L02d')) document.getElementById('L02d').innerHTML = "Annahme: Kabel mit PVC Isolierung; maximale Betriebstemperatur 70°C";
        if(document.getElementById('L02e')) document.getElementById('L02e').innerHTML = "Zusätzlich einige anderen Vereinfachungen und Annahmen!";
        if(document.getElementById('L02f')) document.getElementById('L02f').innerHTML = "Sicherungsdaten: basierend auf Littlefuse Datenblättern";
		if(document.getElementById('L02g')) document.getElementById('L02g').innerHTML = "Einspeisungen: angenommener max. Strom pro Endeinspeisung 4.5 A; 9 A für Mitteneinspeisung";
        
        if(document.getElementById('L03')) document.getElementById('L03').innerHTML = "Eingaben:";
        if(document.getElementById('L04')) document.getElementById('L04').innerHTML = "LED Streifen Typ:";
        if(document.getElementById('L05')) document.getElementById('L05').innerHTML = "Farbe zum Leuchten:";
        if(document.getElementById('L06')) document.getElementById('L06').innerHTML = "Anzahl von LEDs:";
        if(document.getElementById('L07')) document.getElementById('L07').innerHTML = "Helligkeit:";
        if(document.getElementById('L08')) document.getElementById('L08').innerHTML = "Länge der Zuleitung (PSU zum LED) [cm]:";
        if(document.getElementById('L09')) document.getElementById('L09').innerHTML = "Umgebungstemperatur:";
        if(document.getElementById('L10')) document.getElementById('L10').innerHTML = "Maximaler Spannungseinbruch:";
        if(document.getElementById('L11')) document.getElementById('L11').innerHTML = "Leitungsverlegung:";
        if(document.getElementById('L12')) document.getElementById('L12').innerHTML = "Ergebnisse:";
        if(document.getElementById('L12a')) document.getElementById('L12a').innerHTML = "LED Leistungsaufnahme: ";
        if(document.getElementById('L12b')) document.getElementById('L12b').innerHTML = "Empfohlener minimaler Querschnitt der Zuleitungen: ";
        if(document.getElementById('L12c')) document.getElementById('L12c').innerHTML = "Empfohlene Sicherung (KFZ Standard oder Mini): ";
        if(document.getElementById('L12d')) document.getElementById('L12d').innerHTML = "Spannungsabfall gesamt (Zuleitung  + Sicherung): ";
        
        if(document.getElementById('L14b')) document.getElementById('L14b').innerHTML = 'DIY WLED Boards:';
        if(document.getElementById('L14c')) document.getElementById('L14c').innerHTML = 'Professional WLED Controllers: <a href="https://shop.myhome-control.de">MyHome-Control Shop</a>';
        if(document.getElementById('L14d')) document.getElementById('L14d').innerHTML = 'WEB-basierter WLED Software Installer:';
        if(document.getElementById('L14')) document.getElementById('L14').innerHTML = "Nützliche Informationen:";
        if(document.getElementById('L18')) document.getElementById('L18').innerHTML = 'Impressum';
        if(document.getElementById('L19')) document.getElementById('L19').innerHTML = 'Datenschutzerklärung';
        if(document.getElementById('L20')) document.getElementById('L20').innerHTML = 'Leitungsberechnung nach EU/US:';
		if(document.getElementById('L21')) document.getElementById('L21').innerHTML = 'Empfohlene Anzahl der Einspeisungen:';
		if(document.getElementById('L22')) document.getElementById('L22').innerHTML = 'Hoher Strom: mit Einspeisungen berechnen:';
		for(var i = 1; i <= MAX_INJ; i++) {
			if(document.getElementById('L23_'+i.toString())) document.getElementById('L23_'+i.toString()).innerHTML = 'Leitungslänge Einspeisung L'+i.toString()+' [cm]:';
		}
		if(document.getElementById('L24')) document.getElementById('L24').innerHTML = 'Ergebnisse (Stromeinspeisungen):';
      
    } else {
        if(document.getElementById('L01')) document.getElementById('L01').innerHTML = "<span style='color:red'>Attention:</span> estimation only! <span style='color:blue;text-decoration: underline;'>Find out here more details</span>";
        if(document.getElementById('L02b')) document.getElementById('L02b').innerHTML = "For a specified design of an electrical system, YOU must precisely meet the normative specifications applicable in your country! This calculator can only provide a first estimate!";
        if(document.getElementById('L02c')) document.getElementById('L02c').innerHTML = "Normative bases: VDE 0298 Teil 2 und 4, VDE 0100 Teil 430 (German technical rules)";
        if(document.getElementById('L02d')) document.getElementById('L02d').innerHTML = "Assumption: cable with PVC insulation; maximum operating temperature 70°C";
        if(document.getElementById('L02e')) document.getElementById('L02e').innerHTML = "Additionally some other simplifications and assumptions!";
        if(document.getElementById('L02f')) document.getElementById('L02f').innerHTML = "Fuse data: based on Littlefuse data sheets";
		if(document.getElementById('L02g')) document.getElementById('L02g').innerHTML = "Power injections: assumed max. current per end injection 4.5 A; 9 A for middle injection";
        
        if(document.getElementById('L03')) document.getElementById('L03').innerHTML = "Input fields:";
        if(document.getElementById('L04')) document.getElementById('L04').innerHTML = "LED strip type:";
        if(document.getElementById('L05')) document.getElementById('L05').innerHTML = "Color to be controlled:";
        if(document.getElementById('L06')) document.getElementById('L06').innerHTML = "Number of LEDs:";
        if(document.getElementById('L07')) document.getElementById('L07').innerHTML = "Brightness:";
        if(document.getElementById('L08')) document.getElementById('L08').innerHTML = "Wire length (PSU to LED) [cm]:";
        if(document.getElementById('L09')) document.getElementById('L09').innerHTML = "Ambient temperature:";
        if(document.getElementById('L10')) document.getElementById('L10').innerHTML = "Max allowed voltage drop:";
        if(document.getElementById('L11')) document.getElementById('L11').innerHTML = "Wire laying:";
        if(document.getElementById('L12')) document.getElementById('L12').innerHTML = "Results:";
        if(document.getElementById('L12a')) document.getElementById('L12a').innerHTML = "LED power consumption: ";
        if(document.getElementById('L12b')) document.getElementById('L12b').innerHTML = "Recommended minimal wire crosssection: ";
        if(document.getElementById('L12c')) document.getElementById('L12c').innerHTML = "Recommended fuse (automotive standart or mini): ";
        if(document.getElementById('L12d')) document.getElementById('L12d').innerHTML = "Total voltage drop (wire  + fuse): ";
        
        if(document.getElementById('L14b')) document.getElementById('L14b').innerHTML = 'DIY WLED boards:';
        if(document.getElementById('L14c')) document.getElementById('L14c').innerHTML = 'Professional WLED controllers: <a href="https://wled.shop">WLED Shop</a>';
        if(document.getElementById('L14d')) document.getElementById('L14d').innerHTML = 'WEB-based WLED software installer:';
        if(document.getElementById('L14')) document.getElementById('L14').innerHTML = "Useful web pages:";
        if(document.getElementById('L18')) document.getElementById('L18').innerHTML = 'Imprint';
        if(document.getElementById('L19')) document.getElementById('L19').innerHTML = 'Data privacy';
        if(document.getElementById('L20')) document.getElementById('L20').innerHTML = 'Wire cross sections to use:';
		if(document.getElementById('L21')) document.getElementById('L21').innerHTML = 'Recommended number of injections:';
		if(document.getElementById('L22')) document.getElementById('L22').innerHTML = 'High current: calculate with power injections:';
		
		for(var i = 1; i <= MAX_INJ; i++) {
			if(document.getElementById('L23_'+i.toString())) document.getElementById('L23_'+i.toString()).innerHTML = 'Wire lenght injection L'+i.toString()+' [cm]:';
		}
		if(document.getElementById('L24')) document.getElementById('L24').innerHTML = 'Injection results:';

    }
    LoadDataset();
	ShowImprint();
	ShowDataPrivacy();
}

function ShowImprint() {
    if(document.getElementById('lang').selectedIndex==0) {
        document.getElementById('imprint').innerHTML = "<br><h3>Impressum</h3>Angaben gemäß § 5 TMG:<br>Verantwortlicher: Wladislaw Waag<br>Adresse: Wasserburger Landstr. 29, 81825 München, Deutschland<br>Kontakt: +49 (0) 176 47 11 5206, info@myhome-control.de<br><br>EU-Streitschlichtung: Die Europäische Kommission stellt eine Plattform zur Online-Streitbeilegung (OS) bereit: <a href='https://ec.europa.eu/consumers/odr/' target='_blank'>https://ec.europa.eu/consumers/odr/</a>.<br><br>Verbraucherstreitbeilegung/Universalschlichtungsstelle: Wir sind nicht bereit oder verpflichtet, an Streitbeilegungsverfahren vor einer Verbraucherschlichtungsstelle teilzunehmen.";
    } else {
        document.getElementById('imprint').innerHTML = "<br><h3>Imprint</h3>Information according to § 5 TMG:<br>Responsible: Wladislaw Waag<br>Address: Wasserburger Landstr. 29, 81825 Munich, Germany<br>Contact: +49 176 47 11 5206, info@myhome-control.de<br><br>EU dispute settlement: The European Commission provides a platform for online dispute resolution (ODR): <a href='https://ec.europa.eu/consumers/odr/' target='_blank'>https://ec.europa.eu/consumers/odr/</a>.<br><br>Consumer dispute settlement / universal arbitration board: We are neither willing nor obliged to participate in dispute settlement proceedings before a consumer arbitration board.";
    }
}
  
function ShowDataPrivacy() {
    if(document.getElementById('lang').selectedIndex==0) {
        document.getElementById('dataprivacy').innerHTML = "<br><h3>Datenschutzerklärung</h3>Der Betreiber dieser Webseite (https://wled-calculator.github.io) sammelt und verarbeitet keinerlei personenbezogenen Daten der Nutzer dierser Webseite. Diese Seite wird jedoch im Rahmen von 'Github Pages' gehostet und betrieben. Es ist möglich und wahrscheinlich, dass Github die personenbezogenen Daten sammelt und verarbeitet. Das betrifft dann auch die Besucher der Webseite wled-calculator.github.io. Ich habe aber keinerlei Einfluss darauf. Bitte lesen Sie dazu die Datenschutzerklärung von Github: <a href='https://docs.github.com/en/github/site-policy/github-privacy-statement' target='_blank'>https://docs.github.com/en/github/site-policy/github-privacy-statement</a><br><br>Unsere Webseite enthält Links zu externen Webseiten Dritter, auf deren Inhalte wir keinen Einfluss haben. Für diese fremden Inhalte können wir keine Gewähr und keine Haftung übernehmen. Für die Inhalte der verlinkten Seiten ist immer der jeweilige Anbieter oder Betreiber der Seiten verantwortlich. Die verlinkten Seiten wurden zum Zeitpunkt der Verlinkung auf mögliche Rechtsverstöße überprüft. Rechtswidrige Inhalte waren dabei nicht erkennbar. Sollten uns Rechtsverletzungen bekannt werden, werden wir die entsprechende Verlinkung umgehend entfernen.";
    } else {
        document.getElementById('dataprivacy').innerHTML = "<br><h3>Data privacy</h3>The operator of this website (https://wled-calculator.github.io) does not collect and process any personal data of the users of this website. However, this page is hosted and operated as part of 'Github Pages'. It is possible and probable that Github collects and processes personal data, which then also affects visitors of the wled-calculator.github.io web page. But I have no influence on it. Please read the Github privacy statement: <a href='https://docs.github.com/en/github/site-policy/github-privacy-statement' target='_blank'>https://docs.github.com/en/github/site-policy/github-privacy-statement</a><br><br>Our website contains links to external websites over which we have no control. We cannot accept any liability for this third-party content. The respective provider or operator of the pages is always responsible for the content of the linked pages. The linked pages were checked for possible legal violations at the time of linking. Illegal content was not recognizable at that time. If we become aware of any legal violations, we will remove the relevant link immediately.";
    }
}

function CalcResults() {
    var fuse_load_factor = 0.9;
    var led_index=parseInt(document.getElementById('select-leds').value);
    var voltage = dataset.leds.voltages[led_index];
    var power150=0;
    var wire_cstype=document.getElementById('select-wire-cs').value;
    var color_index=parseInt(document.getElementById('select-colors').selectedIndex);
    if(color_index==0) power150=dataset.leds.r_powers[led_index];
    if(color_index==1) power150=dataset.leds.g_powers[led_index];
    if(color_index==2) power150=dataset.leds.b_powers[led_index];
    if(color_index==3) power150=dataset.leds.rgb_powers[led_index];
    if(color_index==4) power150=dataset.leds.w_powers[led_index];
    if(color_index==5) power150=dataset.leds.rgbw_powers[led_index];

    var brightness_index=parseInt(document.getElementById('select-brightness').value);
    var brightness=dataset.light_factors.factors[brightness_index];
    var numleds=parseInt(document.getElementById('input-numberofleds').value);
	// wirelen: cm in meter:
    var wirelen=parseInt(document.getElementById('input-wirelen').value)/100;
    var max_vdrop_index=parseInt(document.getElementById('select-vdrop').value);
    var max_vdrop = dataset.vdrop.values[max_vdrop_index];
    var amb_temp_index=parseInt(document.getElementById('select-temp').value);
    var amb_temp = dataset.tempcoeff.temps[amb_temp_index];
    var system_index=parseInt(document.getElementById('select-systems').value);

    var power=power150/150*numleds*brightness;
    document.getElementById('power_result').innerHTML=power.toFixed(2).toString();
    
    var current=power/voltage;
    document.getElementById('current_result').innerHTML=current.toFixed(2).toString();
    
    // we start with the biggest fuse 
    var fuse_index=dataset.fuses.ratings.length-1;
    if(current/fuse_load_factor>dataset.fuses.ratings[fuse_index]*(1+(25-amb_temp)/650)) {
        document.getElementById('fuse_result').innerHTML="<span style='color:red'>Too high current for an automotive mini fuse!</span>";
        document.getElementById('mm2_result').innerHTML="<span style='color:red'>--</span>";
        document.getElementById('awg_result').innerHTML="<span style='color:red'>--</span>";
        document.getElementById('vdrop_result').innerHTML="<span style='color:red'>--</span>";
		document.getElementById('numinj_result').innerHTML="<span style='color:red'>--</span>";
		document.getElementById('injstring_result').innerHTML="";
		document.getElementById('InjAccordion').style.display = "none";
        return;
    } else {
        document.getElementById('fuse_result').innerHTML="";
        document.getElementById('mm2_result').innerHTML="";
        document.getElementById('awg_result').innerHTML="";
        document.getElementById('vdrop_result').innerHTML="";
    }
    // check all lower fuses if they fulfill the requirements
   for(var i = fuse_index-1; i>=0; i--) {
        if(current/fuse_load_factor<=dataset.fuses.ratings[i]*(1+(25-amb_temp)/650)) {
            fuse_index--;
        }
      }
    // get rating and color of the fuse
    var fuse_rating=dataset.fuses.ratings[fuse_index];
    var fuse_color= "("+(document.getElementById('lang').selectedIndex==0?("Farbe der Sicherung: "+dataset.fuses.colors_de[fuse_index]):("fuse color: "+dataset.fuses.colors_en[fuse_index]))+")";
    // calculate voltage drop over the fuse
    var fuse_vdrop=dataset.fuses.voltage_drops[fuse_index]/fuse_rating*current/1000;
    document.getElementById('fuse_result').innerHTML=fuse_rating.toString();
    document.getElementById('fuse_result_color').innerHTML=fuse_color;
    
    // calculate volatge drop left for the wire
    var wire_vdrop=0;
    var allowed_wire_vdrop = max_vdrop - fuse_vdrop;
    // calculate minimum crosssection required based on voltage drop
    var q_drop = 2*current*0.01786*wirelen/allowed_wire_vdrop*(1+0.0039*(70-20));
    // get temperature coefficient for wire, will be needed later
    var wire_temp_coef = dataset.tempcoeff.factors[amb_temp_index];
    
    // start with the thickest wire (higher index in dataset)
    var wire_index=dataset[wire_cstype].crosssections.length-1;
    if(fuse_rating>dataset[wire_cstype].max_currents[system_index][wire_index]*wire_temp_coef) {
        document.getElementById('mm2_result').innerHTML="<span style='color:red'>Too high current</span>";
        document.getElementById('awg_result').innerHTML="<span style='color:red'>--</span>";
        document.getElementById('vdrop_result').innerHTML="<span style='color:red'>--</span>";
		document.getElementById('numinj_result').innerHTML="<span style='color:red'>--</span>";
		document.getElementById('injstring_result').innerHTML="";
		document.getElementById('InjAccordion').style.display = "none";
        return;
    } else {
        document.getElementById('mm2_result').innerHTML="";
        document.getElementById('awg_result').innerHTML="";
        document.getElementById('vdrop_result').innerHTML="";
		document.getElementById('numinj_result').innerHTML="";
    }
    // go down all wires crosssections, checking if they are still OK
    for(var i = wire_index-1; i>=0; i--) {
        if(fuse_rating<=dataset[wire_cstype].max_currents[system_index][i]*wire_temp_coef && 2*current*0.01786*wirelen/dataset[wire_cstype].crosssections[i]*(1+0.0039*(70-20))<=allowed_wire_vdrop) {
            wire_index--;
        }
    }
    // now we have lowest wire_index, calculate resulting voltage drop
    wire_vdrop = 2*current*0.01786*wirelen/dataset[wire_cstype].crosssections[wire_index]*(1+0.0039*(70-20))
    
    document.getElementById('mm2_result').innerHTML=dataset[wire_cstype].crosssections[wire_index];
    document.getElementById('awg_result').innerHTML=dataset[wire_cstype].awgs[wire_index];
    
    //resulting total voltage drop
    var total_vdrop=wire_vdrop+fuse_vdrop;
    document.getElementById('vdrop_result').innerHTML=total_vdrop.toFixed(3).toString();
	
	//resulting number of injections
	var INJ_MAX_CURRENT=4.5;
	var number_injections = 0;
	if(current<=INJ_MAX_CURRENT) {
		number_injections=1;
	} else {
		if(current<=INJ_MAX_CURRENT*2) {
			number_injections=2;
		} else {
			number_injections=2+Math.ceil((current-INJ_MAX_CURRENT*2)/(INJ_MAX_CURRENT*2));
		}
	}
	document.getElementById('numinj_result').innerHTML=number_injections.toString();
	
	// injections: comment
	var inj_string="";
	if(number_injections==1) inj_string=document.getElementById('lang').selectedIndex==0?"am Beginn der LED Strip":"at the beginning of the LED strip";
	if(number_injections==2) inj_string=document.getElementById('lang').selectedIndex==0?"am Beginn und am Ende der LED Strip":"at the beginning and at the end of the LED strip";
	if(number_injections==3) inj_string=document.getElementById('lang').selectedIndex==0?"am Beginn, am Ende der LED Strip und in der Mitte ":"at the beginning, at the end of the LED strip and in the middle";
	if(number_injections>3) inj_string=document.getElementById('lang').selectedIndex==0?"am Beginn, am Ende der LED Strip und dazwischen verteilt":"at the beginning, at the end of the LED strip and inbetween distributed";
	document.getElementById('injstring_result').innerHTML=" ("+inj_string+")";
	
	// injections: accordion
	if(number_injections==1) {
		document.getElementById('InjAccordion').style.display = "none";
	} else {
		document.getElementById('InjAccordion').style.display = "initial";
	}
	
	for(var i = 1; i <= MAX_INJ; i++) {
		if(i<=number_injections && number_injections>1) {
			document.getElementById('wlen'+i.toString()).style.display = "initial";
		} else {
			document.getElementById('wlen'+i.toString()).style.display = "none";
		}
	}
	
	inj_arr_max_current=[];
	inj_arr_max_voltage_drop=[];
	inj_arr_max_voltage_drop_toohigh=[0]; // init with zero to be able ti use reduce
	inj_arr_fuse_rating=[];
	inj_arr_fuse_color=[];
	inj_arr_wire_length=[];
	inj_arr_wire_crosssection=[];
	inj_arr_wire_awg=[];
	
	var curr_inj=0;
	for(var j = 1; j <= number_injections; j++) {
		// wirelen: cm in meter:
		wirelen_inj=parseInt(document.getElementById('input-wirelen'+j.toString()).value)/100;
		// current in injection
		curr_inj=current/(number_injections==1?1:2+Math.max(number_injections-2,0)*2);
		if(j>1 && j<number_injections) {
			curr_inj=curr_inj*2;
		}
		min_crossection=2*curr_inj*0.01786*wirelen_inj*(1+0.0039*(70-20))/max_vdrop;
		console.log(min_crossection);
		
		
		////////////////////////////////////////////////////
		// we start with the biggest fuse 
		fuse_index=dataset.fuses.ratings.length-1;
		// check all lower fuses if they fulfill the requirements
	    for(var i = fuse_index-1; i>=0; i--) {
			if(curr_inj/fuse_load_factor<=dataset.fuses.ratings[i]*(1+(25-amb_temp)/650)) {
				fuse_index--;
			}
		}
		// get rating and color of the fuse
		fuse_rating=dataset.fuses.ratings[fuse_index];
		fuse_color= "("+(document.getElementById('lang').selectedIndex==0?("Farbe der Sicherung: "+dataset.fuses.colors_de[fuse_index]):("fuse color: "+dataset.fuses.colors_en[fuse_index]))+")";
		// calculate voltage drop over the fuse
		fuse_vdrop=dataset.fuses.voltage_drops[fuse_index]/fuse_rating*curr_inj/1000;		
		// calculate volatge drop left for the wire
		wire_vdrop=0;
		allowed_wire_vdrop = max_vdrop - fuse_vdrop;
		// calculate minimum crosssection required based on voltage drop
		q_drop = 2*curr_inj*0.01786*wirelen_inj/allowed_wire_vdrop*(1+0.0039*(70-20));
		
		// start with the thickest wire (higher index in dataset)
		wire_index=dataset[wire_cstype].crosssections.length-1;
		// go down all wires crosssections, checking if they are still OK
		for(var i = wire_index-1; i>=0; i--) {
			if(fuse_rating<=dataset[wire_cstype].max_currents[system_index][i]*wire_temp_coef && 2*curr_inj*0.01786*wirelen_inj/dataset[wire_cstype].crosssections[i]*(1+0.0039*(70-20))<=allowed_wire_vdrop) {
				wire_index--;
			}
		}
		// now we have lowest wire_index, calculate resulting voltage drop
		wire_vdrop = 2*curr_inj*0.01786*wirelen_inj/dataset[wire_cstype].crosssections[wire_index]*(1+0.0039*(70-20))
		
		//resulting total voltage drop
		total_vdrop=wire_vdrop+fuse_vdrop;
		if(total_vdrop>max_vdrop) {
			inj_arr_max_voltage_drop_toohigh[j]=1;
		} else {
			inj_arr_max_voltage_drop_toohigh[j]=0;
		}
		
		console.log("INJ="+j.toString()+"; fuse_rating="+fuse_rating.toString()+"; crossec="+dataset[wire_cstype].crosssections[wire_index]+"(AWG "+dataset[wire_cstype].awgs[wire_index]+"); total_vdrop="+total_vdrop.toString());
		inj_arr_max_current[j]=curr_inj.toFixed(2).toString()+ " A";
		inj_arr_max_voltage_drop[j]=total_vdrop.toFixed(3).toString()+ " V";
		inj_arr_fuse_rating[j]=fuse_rating.toString()+" A";
		inj_arr_fuse_color[j]=document.getElementById('lang').selectedIndex==0?(dataset.fuses.colors_de[fuse_index]):(dataset.fuses.colors_en[fuse_index]);
		inj_arr_wire_length[j]=document.getElementById('input-wirelen'+j.toString()).value+" cm";
		inj_arr_wire_crosssection[j]=dataset[wire_cstype].crosssections[wire_index] +" mm<sup>2</sup>";
		inj_arr_wire_awg[j]=dataset[wire_cstype].awgs[wire_index];
		////////////////////////////////////////////////////
		
	}
	if(number_injections>1) {
		document.getElementById('SystemImageInj').innerHTML='<img src="System_'+number_injections.toString()+'inj.jpg" class="img-fluid" alt="system schematics" style="width:400px;">';
	}
	
	// build result table
	lang_index=document.getElementById('lang').selectedIndex;
	// head
	InjResultsHead='<tr><th></th><th style="text-align:center;" colspan="'+j.toString()+'">'+(lang_index==0?'Einspeisungen':'Injections')+'</th></tr><tr><th scope="col">Parameter</th>';
	for(var j = 1; j <= number_injections; j++) {
		InjResultsHead=InjResultsHead+'<th style="text-align:center;" scope="col">'+j.toString()+'</th>';
	}
	InjResultsHead=InjResultsHead+"<tr>";
	document.getElementById('InjResultsHead').innerHTML=InjResultsHead;
	
	//body
	InjResultsBody='';
	
	InjResultsBody=InjResultsBody+'<tr><th scope="row">'+(lang_index==0?'Länge der Zuleitung':'Wire length')+'</th>';
	for(var j = 1; j <= number_injections; j++) {
		InjResultsBody=InjResultsBody+'<td style="text-align:center;">'+inj_arr_wire_length[j]+'</td>';
	}
	InjResultsBody=InjResultsBody+'</tr>';
	
	InjResultsBody=InjResultsBody+'<tr><th scope="row">'+(lang_index==0?'Leitungsquerschnitt':'Wire cross section')+'</th>';
	for(var j = 1; j <= number_injections; j++) {
		InjResultsBody=InjResultsBody+'<td style="text-align:center;">'+inj_arr_wire_crosssection[j]+' (AWG '+inj_arr_wire_awg[j]+')</td>';
	}
	InjResultsBody=InjResultsBody+'</tr>';
	
	InjResultsBody=InjResultsBody+'<tr><th scope="row">'+(lang_index==0?'Max. Strom':'Max. current')+'</th>';
	for(var j = 1; j <= number_injections; j++) {
		InjResultsBody=InjResultsBody+'<td style="text-align:center;">'+inj_arr_max_current[j]+'</td>';
	}
	InjResultsBody=InjResultsBody+'</tr>';
	
	InjResultsBody=InjResultsBody+'<tr><th scope="row">'+(lang_index==0?'Sicherung Nominalwert':'Fuse rated value')+'</th>';
	for(var j = 1; j <= number_injections; j++) {
		InjResultsBody=InjResultsBody+'<td style="text-align:center;">'+inj_arr_fuse_rating[j]+'</td>';
	}
	InjResultsBody=InjResultsBody+'</tr>';
	
	InjResultsBody=InjResultsBody+'<tr><th scope="row">'+(lang_index==0?'Sicherung Farbe':'Fuse color')+'</th>';
	for(var j = 1; j <= number_injections; j++) {
		InjResultsBody=InjResultsBody+'<td style="text-align:center;">'+inj_arr_fuse_color[j]+'</td>';
	}
	InjResultsBody=InjResultsBody+'</tr>';
	
	InjResultsBody=InjResultsBody+'<tr><th scope="row">'+(lang_index==0?'Max. Spannungsabfall':'Max. voltage drop')+'</th>';
	for(var j = 1; j <= number_injections; j++) {
		InjResultsBody=InjResultsBody+'<td style="text-align:center;">'+(inj_arr_max_voltage_drop_toohigh[j]==1?'<span style="color:red">':'')+inj_arr_max_voltage_drop[j]+(inj_arr_max_voltage_drop_toohigh[j]==1?'<sup>(*)</sup></span>':'')+'</td>';
	}
	InjResultsBody=InjResultsBody+'</tr>';
	document.getElementById('InjResultsBody').innerHTML=InjResultsBody;
	
	if((inj_arr_max_voltage_drop_toohigh.reduce((partialSum, a) => partialSum + a, 0))>0) {
		document.getElementById('AttentionToLongWire').innerHTML=(lang_index==0?'Achtung: Spannungsabfall ist zu hoch wegen zu langer Leitung!':'Attention: too high voltage drop because of too long wire!');
	} else {
		document.getElementById('AttentionToLongWire').innerHTML='';
	}
}

function LoadDataset() {
  const xhttp = new XMLHttpRequest();
  xhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
      dataset = JSON.parse(this.responseText);
      sel=document.getElementById('select-leds');
      sel.innerHTML="";
      for(var i = 0; i < dataset.leds.types.length; i++) {
        var opt = document.createElement('option');
        opt.value = i;
        opt.innerHTML = dataset.leds.types[i];
        sel.appendChild(opt);
      }
      sel=document.getElementById('select-colors');
      sel.innerHTML="";
      for(var i = 0; i < dataset.colors.names_de.length; i++) {
        var opt = document.createElement('option');
        opt.value = i;
        opt.innerHTML = document.getElementById('lang').selectedIndex==0?dataset.colors.names_de[i]:dataset.colors.names_en[i];
        sel.appendChild(opt);
      }
      sel.selectedIndex=3;
      
      sel=document.getElementById('select-brightness');
      sel.innerHTML="";
      for(var i = 0; i < dataset.light_factors.names.length; i++) {
        var opt = document.createElement('option');
        opt.value = i;
        opt.innerHTML = dataset.light_factors.names[i];
        sel.appendChild(opt);
      }
      
      sel=document.getElementById('select-temp');
      sel.innerHTML="";
      for(var i = 0; i < dataset.tempcoeff.temps.length; i++) {
        var opt = document.createElement('option');
        opt.value = i;
        opt.innerHTML = dataset.tempcoeff.temps[i]+ " °C";
        sel.appendChild(opt);
      }
      sel.selectedIndex=3;
      
      sel=document.getElementById('select-vdrop');
      sel.innerHTML="";
      for(var i = 0; i < dataset.vdrop.names_de.length; i++) {
        var opt = document.createElement('option');
        opt.value = i;
        opt.innerHTML = document.getElementById('lang').selectedIndex==0?dataset.vdrop.names_de[i]:dataset.vdrop.names_en[i];
        sel.appendChild(opt);
      }
      sel.selectedIndex=1;
      
      sel=document.getElementById('select-systems');
      sel.innerHTML="";
      for(var i = 0; i < dataset.systems.names_de.length; i++) {
        var opt = document.createElement('option');
        opt.value = i;
        opt.innerHTML = document.getElementById('lang').selectedIndex==0?dataset.systems.names_de[i]:dataset.systems.names_en[i];
        sel.appendChild(opt);
      }
      
      inp=document.getElementById('input-numberofleds');
      inp.value=150;
      inp=document.getElementById('input-wirelen');
      inp.value=50;
	  
	  for(var i = 1; i <= MAX_INJ; i++) {
		  inp=document.getElementById('input-wirelen'+i.toString());
		  inp.value=50*i;
	  }
      
      document.getElementById('MainContainer').style.display = "initial";
      document.getElementById('WaitContainer').style.display = "none";
      CalcResults();
    }
  };
  xhttp.open("GET", "dataset.json");
  xhttp.send(); 
}

window.onload = function () {
    document.getElementById('MainContainer').style.display = "none";
    document.getElementById('WaitContainer').style.display = "initial";
    LangChanged();
};
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-A3rJD856KowSb7dwlZdYEkO39Gagi7vIsF0jrRAoQmDKKtQBHUuLZ9AsSv4jD4Xa" crossorigin="anonymous"></script>
</body>
</html>